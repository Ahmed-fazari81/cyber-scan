<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CyberShield</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
body{
    font-family: system-ui;
    background:#0f172a;
    color:white;
    margin:0;
    padding:20px;
}
.container{
    max-width:600px;
    margin:auto;
}
input,button{
    width:100%;
    padding:14px;
    margin-top:10px;
    border-radius:10px;
    border:none;
    font-size:16px;
}
button{
    background:#00d2ff;
    color:black;
    font-weight:bold;
    cursor:pointer;
}
#resultBox{
    margin-top:20px;
    padding:15px;
    background:#020617;
    border-radius:10px;
    display:none;
    white-space:pre-wrap;
}
</style>
</head>

<body>

<div class="container">

<h2>ğŸ›¡ï¸ CyberShield</h2>

<input type="text" id="mainInput" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§">

<input type="file" id="fileInput" accept="image/*,video/*">

<button onclick="startScan()">ÙØ­Øµ Ø§Ù„Ø¢Ù†</button>

<div id="resultBox"></div>

</div>

<script>
let uploadedFileBase64 = null;
let uploadedMimeType = null;

document.getElementById("fileInput").addEventListener("change", function(e){
    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(ev){
        uploadedMimeType = file.type;
        uploadedFileBase64 = ev.target.result.split(",")[1];
    };
    reader.readAsDataURL(file);
});

function analyzeURLLocally(url){
    try{
        const u = new URL(url);
        const warnings=[];

        if(url.length>120) warnings.push("Ø±Ø§Ø¨Ø· Ø·ÙˆÙŠÙ„ Ø¨Ø´ÙƒÙ„ Ù…Ø±ÙŠØ¨");
        if(u.hostname.includes("login")) warnings.push("ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø´Ø¨ÙˆÙ‡Ø©");
        if(u.hostname.split(".").length>3) warnings.push("Ù†Ø·Ø§Ù‚ ÙØ±Ø¹ÙŠ Ù…Ø±ÙŠØ¨");

        return warnings;
    }catch{
        return [];
    }
}

async function startScan(){

    const inputVal = document.getElementById("mainInput").value;
    const resultBox = document.getElementById("resultBox");

    if(!inputVal && !uploadedFileBase64){
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø£Ùˆ Ù…Ù„Ù");
        return;
    }

    resultBox.style.display="block";
    resultBox.innerText="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";

    try{
        const response = await fetch("http://localhost:3000/analyze",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({
                text: uploadedFileBase64 ? null : inputVal,
                fileBase64: uploadedFileBase64,
                mimeType: uploadedMimeType,
                lang: "ar"
            })
        });

        const data = await response.json();
        let resultText = data.result;

        if(!uploadedFileBase64){
            const local = analyzeURLLocally(inputVal);
            if(local.length){
                resultText += "\n\nØªØ­Ù„ÙŠÙ„ Ù…Ø­Ù„ÙŠ:\n" + local.join("\n");
            }
        }

        resultBox.innerText = resultText;

    }catch(err){
        resultBox.innerText="Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
    }
}

if("serviceWorker" in navigator){
    navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
